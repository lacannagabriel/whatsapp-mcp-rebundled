version: '3.8'

services:
  whatsapp-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whatsapp-mcp-server
    ports:
      - "8000:8000"  # MCP Streamable HTTP server
      - "8080:8080"  # WhatsApp bridge API
    volumes:
      # Persist WhatsApp session and message databases
      # IMPORTANTE: Na primeira vez, rode `docker logs -f whatsapp-mcp-server` 
      # para ver o QR code e escanear com o WhatsApp
      - ./whatsapp-bridge/store:/app/whatsapp-bridge/store
    environment:
      - WHATSAPP_BRIDGE_URL=http://localhost:8080
      - MCP_HTTP_PORT=8000
    restart: unless-stopped
    stdin_open: true  # Mant√©m stdin aberto para o Go interagir
    tty: true         # Aloca um pseudo-TTY para output do QR code
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
